<%- partial('nav')%>
<%- partial('sitehead')%>
<% var year, prev_year = 0, first = true; %>

<main class="container" role="main">
  <div class="widget">
    <ul class="tag-box inline list-unstyled">
      <% var years = _.uniq(site.posts.sort('date', -1).map(p => p.date.year())) %>
      <% years.forEach(function (year) { %>
      <li>
        <a href="<%= config.root + config.archive_dir + "/" + year %>"><%= year %></a>
      </li>
      <% }); %>
    </ul>
  </div>

  <% var archives = site.posts.filter(p => !page.year || p.date.year() === page.year) %>
  <% archives.sort('date', -1).each(function (post) { %>
    <% var year = post.date.year(); %>
    <% if (year !== prev_year && prev_year !== 0) { %>
      </ul>
    <% } %>
    <% if (year !== prev_year) {%>
      <% if (!page.year) { %>
      <p class="archive-ul" data-toggle="collapse" data-target="#<%= year %>">
        <%= year %>&nbsp;<b class="caret"></b>
      </p>
      <% } %>
      <ul id="<%= year %>"class="in">
      <% prev_year = year %>
    <% } %>
    <li class="listing-item">
      <p class="post-title">
        <a href="<%- config.root %><%- post.path %>"><%- post.title %></a>
        <small class="post-meta">
          <time datetime="<%= date_xml(post.date) %>" itemprop="datePublished"><%= date(post.date, null) %></time>
        </small>
      </p>
    </li>
  <% }); %>
    </ul>
</main>
