<%- partial('nav')%>
<%- partial('sitehead')%>
<% var year, prev_year = 0, first = true; %>

<main class="container" role="main">
  <div class="widget">
    <ul class=" tag-box inline list-unstyled">
      <% site.tags.sort('name').each(function(item){ %>
      <li><a href="<%= config.root + item.path %>"><%= item.name %><sup><%= item.posts.length %></sup></a></li>
      <% }); %>
    </ul>
  </div>

  <% site.posts.sort('date', -1).each(function(post) { %>
  <% var year = post.date.year(); %>
  <% var tags = post.tags.map(function (t) { return t.name; }); %>
    <% if (tags.indexOf(page.tag) < 0) return; %>
    <% if (year !== prev_year) {%>
      </ul>
    <p class="archive-ul" data-toggle="collapse" data-target="#<%= year %>">
        <%= year %>&nbsp;<b class="caret"></b>
    </p>
    <ul id="<%= year %>"class="collapse in">
    <% prev_year = year %>
    <% } %>
    <li class="listing-item">
      <p class="post-title">
        <a href="<%- config.root %><%- post.path %>"><%- post.title %></a>
        <small class="post-meta">
          <time datetime="<%= date_xml(post.date) %>" itemprop="datePublished"><%= date(post.date, null) %></time>
        </small>
      </p>
    </li>
  <% }); %>
    </ul>
</main>
